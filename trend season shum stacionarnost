#Ссылка на гугл колаб с нахождением сезонности,тренда, стационарности и шума
import pandas as pd
import matplotlib.pyplot as plt
from statsmodels.tsa.seasonal import seasonal_decompose
from statsmodels.tsa.stattools import adfuller

data = pd.read_csv('merged_df_cleaned.csv', parse_dates=['dt'], index_col='dt')

data['Концентрат коксующегося угля_Россия марка ОС FCA руб./т, без НДС'].plot(figsize=(12, 6))
plt.title('Цена на уголь (марка ОС)')
plt.xlabel('Дата')
plt.ylabel('Цена')
plt.show()

result = seasonal_decompose(data['Концентрат коксующегося угля_Россия марка ОС FCA руб./т, без НДС'], model='additive', period=12)
result.plot()
plt.show()

def check_stationarity(series):
    result = adfuller(series)
    print('ADF Statistic:', result[0])
    print('p-value:', result[1])
    print('Critical Values:', result[4])
    if result[1] <= 0.05:
        print("Ряд стационарен")
    else:
        print("Ряд нестационарен")




# Первое дифференцирование (удаление тренда)
diff_series = series.diff().dropna()

# Визуализация первого дифференцирования
plt.figure(figsize=(12, 6))
plt.plot(diff_series, label='Первое дифференцирование', color='orange')
plt.title('Первое дифференцирование: Концентрат коксующегося угля (марка ОС)')
plt.xlabel('Дата')
plt.ylabel('Разность цен')
plt.axhline(0, color='red', linestyle='--', label='Нулевая линия')
plt.legend()
plt.grid(True)
plt.show()

# Проверка стационарности исходного ряда
def check_stationarity(series, title):
    result = adfuller(series)
    print(f'Результаты теста Дики-Фуллера для {title}:')
    print('ADF Statistic:', result[0])
    print('p-value:', result[1])
    print('Critical Values:', result[4])
    if result[1] <= 0.05:
        print("Ряд стационарен")
    else:
        print("Ряд нестационарен")
    print('---')

# Проверка стационарности исходного ряда
check_stationarity(series, 'исходного')





series = data['Концентрат коксующегося угля_Россия марка ОС FCA руб./т, без НДС']

result = seasonal_decompose(series, model='additive', period=12)  # period=12 для месячных данных

plt.figure(figsize=(12, 6))
plt.plot(result.resid, label='Остаток (шум)')
plt.title('Шум в данных: Концентрат коксующегося угля (марка ОС)')
plt.xlabel('Дата')
plt.ylabel('Остаток')
plt.axhline(0, color='red', linestyle='--', label='Нулевая линия')
plt.legend()
plt.grid(True)
plt.show()

Итоговый вывод:
Сезонность: В данных присутствует сезонность, которая проявляется в виде регулярных колебаний с периодичностью 12 месяцев. Это важно учитывать при прогнозировании, так как сезонные изменения могут существенно влиять на динамику цен.

Тренд: Наблюдается выраженный тренд, который отражает долгосрочные изменения в ценах на уголь. Тренд может быть связан с макроэкономическими факторами, такими как спрос, предложение или изменения в издержках производства.

Стационарность: Ряд нестационарен, что требует применения методов для его стабилизации (например, дифференцирование). Это необходимо для корректного использования статистических моделей, таких как ARIMA.

Шум: Шум в данных является случайным, что подтверждает адекватность модели разложения. Однако, если в остатке наблюдаются аномалии, это может указывать на необходимость уточнения модели или учета дополнительных факторов.g
